import{r as e,j as t,z as s,p as a,Z as r,g as i,c as l,a as d,x as n,t as c,K as m,a1 as o,H as x,P as g}from"./index-bGB9rp9t.js";import{m as h}from"./motion-DaFSZY4b.js";const b=({onClose:g})=>{const[b,u]=e.useState(null),[y,p]=e.useState(!1),[j,f]=e.useState(null),[N,k]=e.useState([]),[w,v]=e.useState(""),[S,C]=e.useState(!1),I=e.useRef(null);e.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await c.getAll();if(t)return;k(e||[])}catch(e){}})()},[]);const D=()=>{if(!b)return!1;return new Date(b.validUntil)>new Date},R=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),A=()=>{u(null),f(null),p(!1)};return t.jsx(h.div,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:g,children:t.jsx(h.div,{className:"bg-white dark:bg-dark-card rounded-2xl shadow-2xl max-w-md w-full p-6",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900 dark:text-white",children:"ðŸ” Membership Verification"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Scan member's QR code to verify their subscription"}),!b&&!y&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8",children:[t.jsx(s,{className:"mx-auto text-4xl text-gray-400 mb-4"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Upload QR code image to verify membership"}),t.jsx("input",{type:"file",ref:I,onChange:e=>{e.target.files[0]&&(p(!0),f(null),setTimeout(()=>{try{(async()=>{try{const{data:{user:e},error:t}=await o.auth.getUser();if(t)throw new Error("Authentication error: "+t.message);if(!e)throw new Error("No user logged in");const{data:s,error:a}=await x.getById(e.id),r=new Date,i=new Date;i.setFullYear(r.getFullYear()+1);const l=i>r?i:new Date(r.getTime()+31536e6);return{membershipId:`FM${e.id.slice(-8).toUpperCase()}${Date.now().toString().slice(-4)}`,planName:s?.subscription_level||"Premium",memberName:(()=>{if(s){const e=`${s.first_name||""} ${s.last_name||""}`.trim();if(e&&" "!==e)return e}return e.email?e.email.split("@")[0]:"FitClub Member"})(),validUntil:l.toISOString(),planType:"monthly",gymAccess:"500+ Gyms",verificationCode:Math.random().toString(36).substr(2,8).toUpperCase(),issueDate:r.toISOString(),userId:e.id}}catch(e){return{membershipId:"FM12345678",planName:"Premium",memberName:"FitClub Member",validUntil:new Date(Date.now()+31536e6).toISOString(),planType:"monthly",gymAccess:"500+ Gyms",verificationCode:"ABC12DEF",issueDate:(new Date).toISOString(),userId:"demo-user-id"}}})().then(e=>{u(e),p(!1)}).catch(e=>{f("Unable to generate scan result"),p(!1)})}catch(e){f("Invalid QR code or unable to read data"),p(!1)}},1500))},accept:"image/*",className:"hidden"}),t.jsx("button",{onClick:()=>I.current?.click(),className:"btn btn-primary",children:"Upload QR Code Image"})]}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t.jsx("p",{children:"â€¢ Member should show their digital membership QR code"}),t.jsx("p",{children:"â€¢ Take a photo or upload existing image of the QR code"}),t.jsx("p",{children:"â€¢ System will verify membership status automatically"})]})]}),y&&t.jsxs("div",{className:"py-8",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-primary-600 border-t-transparent rounded-full mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Reading QR code..."})]}),j&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(a,{className:"text-red-600 dark:text-red-400 mr-2"}),t.jsx("span",{className:"text-red-700 dark:text-red-300",children:j})]})}),b&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-dark-background rounded-lg p-4",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[t.jsx(r,{className:"inline mr-2"}),"Select Gym Location"]}),t.jsxs("select",{value:w,onChange:e=>v(e.target.value),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-dark-card text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:S,children:[t.jsx("option",{value:"",children:"Choose a gym..."}),N.map(e=>t.jsxs("option",{value:e.id,children:[e.name," - ",e.location]},e.id))]})]}),t.jsxs("div",{className:"p-4 rounded-lg border-2 "+(D()?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:[t.jsxs("div",{className:"flex items-center justify-center mb-2",children:[D()?t.jsx(i,{className:"text-green-600 dark:text-green-400 text-2xl mr-2"}):t.jsx(a,{className:"text-red-600 dark:text-red-400 text-2xl mr-2"}),t.jsx("span",{className:"font-bold text-lg "+(D()?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"),children:D()?"VALID MEMBERSHIP":"EXPIRED MEMBERSHIP"})]}),!D()&&t.jsxs("p",{className:"text-red-600 dark:text-red-400 text-sm",children:["Membership expired on ",R(b.validUntil)]})]}),t.jsx("div",{className:"bg-gray-50 dark:bg-dark-background rounded-lg p-4 text-left",children:t.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(l,{className:"text-gray-500 mr-2"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Member Name"}),t.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:b.memberName})]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"w-4 h-4 bg-primary-600 rounded text-white text-xs flex items-center justify-center mr-2",children:"ID"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Membership ID"}),t.jsx("span",{className:"font-mono font-semibold text-gray-900 dark:text-white",children:b.membershipId})]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(d,{className:"text-gray-500 mr-2"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Plan & Access"}),t.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[b.planName," - ",b.gymAccess]})]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(n,{className:"text-gray-500 mr-2"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Valid Until"}),t.jsx("span",{className:"font-semibold "+(D()?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:R(b.validUntil)})]})]})]})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:A,className:"flex-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg font-medium transition-colors disabled:opacity-50",disabled:S,children:"Scan Another"}),D()?t.jsx("button",{onClick:async()=>{if(b&&w){C(!0),f(null);try{const e={user_id:b.userId,gym_id:w,access_type:"qr_scan",status:"granted",reason:null,scanned_at:(new Date).toISOString()},{error:t}=await m.create(e);if(t)return f("Failed to log access. Please try again."),void C(!1);setTimeout(()=>{g()},1e3)}catch(e){f("An error occurred while granting access"),C(!1)}}else f("Please select a gym before granting access")},className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",disabled:!w||S,children:S?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Logging..."]}):t.jsxs(t.Fragment,{children:[t.jsx(i,{}),"Grant Access"]})}):t.jsx("button",{onClick:()=>(async(e="Membership expired")=>{if(b&&w){C(!0),f(null);try{const t={user_id:b.userId,gym_id:w,access_type:"qr_scan",status:"denied",reason:e,scanned_at:(new Date).toISOString()},{data:s,error:a}=await m.create(t);if(a)return f("Failed to log access denial. Please try again."),void C(!1);A()}catch(t){f("An error occurred while denying access"),C(!1)}}else f("Please select a gym before denying access")})(),className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",disabled:!w||S,children:S?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Logging..."]}):t.jsxs(t.Fragment,{children:[t.jsx(a,{}),"Deny Access"]})})]})]}),!b&&!y&&!j&&t.jsx("button",{onClick:g,className:"mt-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:"Close Scanner"})]})})})};b.propTypes={onClose:g.func.isRequired};const u=()=>{const[a,r]=e.useState(!1);return t.jsxs("div",{className:"min-h-screen py-16 bg-gray-50 dark:bg-dark-background",children:[t.jsx("div",{className:"container-custom max-w-4xl",children:t.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold mb-2 text-gray-900 dark:text-white",children:"ðŸ‹ï¸â€â™‚ï¸ Gym Staff Portal"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Verify member subscriptions using QR code scanning"})]}),t.jsx("div",{className:"bg-white dark:bg-dark-card rounded-xl shadow-lg p-8 mb-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-24 h-24 bg-primary-100 dark:bg-primary-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:t.jsx(s,{className:"text-primary-600 dark:text-primary-400 text-4xl"})}),t.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Membership Verification"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-8 max-w-md mx-auto",children:"Click the button below to start scanning member QR codes. The system will instantly verify their subscription status and access rights."}),t.jsxs("button",{onClick:()=>r(!0),className:"btn btn-primary btn-lg px-8 py-4 text-lg flex items-center mx-auto",children:[t.jsx(s,{className:"mr-3",size:20}),"Start QR Scanner"]})]})}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6 mb-8",children:[t.jsx("h3",{className:"font-bold text-blue-900 dark:text-blue-300 mb-4",children:"ðŸ“‹ How to Use the QR Scanner:"}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-400",children:[t.jsxs("ul",{className:"space-y-2",children:[t.jsxs("li",{className:"flex items-start",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-3 mt-0.5",children:"1"}),"Ask member to show their digital membership QR code"]}),t.jsxs("li",{className:"flex items-start",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-3 mt-0.5",children:"2"}),'Click "Start QR Scanner" button above']}),t.jsxs("li",{className:"flex items-start",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-3 mt-0.5",children:"3"}),"Upload the QR code image for verification"]})]}),t.jsxs("ul",{className:"space-y-2",children:[t.jsxs("li",{className:"flex items-start",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-3 mt-0.5",children:"4"}),"System will show membership status instantly"]}),t.jsxs("li",{className:"flex items-start",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-3 mt-0.5",children:"5"}),"Grant or deny access based on verification result"]}),t.jsxs("li",{className:"flex items-start",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-3 mt-0.5",children:"6"}),"Check their ID if membership shows as expired"]})]})]})]}),t.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-white dark:bg-dark-card p-6 rounded-lg shadow-sm",children:[t.jsx("div",{className:"text-green-600 dark:text-green-400 text-2xl mb-4",children:"âœ…"}),t.jsx("h3",{className:"font-bold mb-2 text-gray-900 dark:text-white",children:"Instant Verification"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"Real-time membership status check with expiration date validation"})]}),t.jsxs("div",{className:"bg-white dark:bg-dark-card p-6 rounded-lg shadow-sm",children:[t.jsx("div",{className:"text-blue-600 dark:text-blue-400 text-2xl mb-4",children:"ðŸ”’"}),t.jsx("h3",{className:"font-bold mb-2 text-gray-900 dark:text-white",children:"Secure Access"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"Encrypted QR codes with verification codes to prevent fraud"})]}),t.jsxs("div",{className:"bg-white dark:bg-dark-card p-6 rounded-lg shadow-sm",children:[t.jsx("div",{className:"text-purple-600 dark:text-purple-400 text-2xl mb-4",children:"ðŸ“Š"}),t.jsx("h3",{className:"font-bold mb-2 text-gray-900 dark:text-white",children:"Access Analytics"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"Track member check-ins and identify access patterns"})]})]}),t.jsx("div",{className:"mt-8 text-center",children:t.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:t.jsxs("p",{className:"text-yellow-700 dark:text-yellow-300 text-sm",children:[t.jsx("strong",{children:"Demo Mode:"})," This is a demonstration of the QR scanning system. In a real implementation, this would connect to your membership database for live verification."]})})})]})}),a&&t.jsx(b,{onClose:()=>r(!1)})]})};export{u as default};
